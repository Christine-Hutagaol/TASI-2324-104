<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Temukan berbagai tanaman obat khas Toba yang bermanfaat untuk kesehatan dan penyembuhan alami.">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.6">
    <title>Toba Medicinal Plant</title>

    <!-- Bootstrap core CSS -->
    <link th:href="@{css/bootstrap.css}" rel="stylesheet" media="screen"/>

    <!-- Favicons -->
    <meta name="msapplication-config" content="/docs/4.4/assets/img/favicons/browserconfig.xml">
    <meta name="theme-color" content="#563d7c">

    <!-- Custom styles -->
    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            width: 100%;
            height: auto;
        }

        body {
            margin: 0;
            padding: 0;
            background-color: #F5FFF4;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
            flex: 1;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
        }

        .overlay.visible {
            visibility: visible;
        }

        .overlay-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }

        .card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: white;
            transition: transform 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card-header {
            font-weight: bold;
            font-size: 1.2em;
        }

        .card-body {
            margin-top: 10px;
        }

        .welcome-section {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            border-radius: 10px;
            margin-top: 50px;
            color: white;
        }

        .welcome-section img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-right: 20px;
        }

        .welcome-text {
            max-width: 600px;
        }

        .welcome-text h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: black; /* Menambahkan warna hitam */
        }

        .welcome-text p {
            font-size: 1.2em;
            color: black; /* Menambahkan warna hitam */
        }

        .search-section {
            margin-top: 30px;
            text-align: center;
            margin-bottom: 30px; /* Tambahkan margin bawah agar terlihat jelas */
        }

        /* Tambahkan kelas untuk animasi slide */
        @keyframes slideDown {
            0% {
                transform: translateY(-100%);
            }
            100% {
                transform: translateY(0);
            }
        }

        /* Atur tampilan list dan animasi slide */
        #product-list {
            animation: slideDown 0.5s ease-out;
        }

        .row.search-section {
            margin-top: 30px;
            text-align: center;
            margin-bottom: 30px; /* Tambahkan margin bawah agar terlihat jelas */
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="/medicinal">
            <img th:src="@{/res/player/Tanaman.png}" alt="Toba Medicinal Plant" width="80" height="30" class="d-inline-block align-top">
            Toba Medicinal Plant
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
                aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        </div>
    </nav>

    <main role="main" class="container">
        <div class="welcome-section">
            <img src="/res/player/logo.png" alt="Toba Medicinal Plant"> <!-- Ganti dengan path gambar Anda -->
            <div class="welcome-text">
                <h1>Welcome to Toba Medicinal Plant</h1>
                <p>Discover various medicinal plants from Toba that are beneficial for health and natural healing.</p>
            </div>
        </div>
        <div class="row search-section">
            <div class="col-sm-8 offset-sm-2">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Enter the name of the medicinal plant" id="inputan" onkeypress="return searchKeyPress(event);">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" onclick="getProducts()">Search</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- List tanaman -->
        <div id="product-list" class="row mt-3">
            <!-- Cards akan ditambahkan di sini -->
        </div>
    </main>

    <!-- Overlay for error messages -->
    <div id="error-overlay" class="overlay">
        <div class="overlay-content" id="error-message">
            <!-- Error message will be inserted here -->
        </div>
    </div>

    <script        src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script type="text/javascript">
        // Function to highlight keyword in text
        function highlightKeyword(text, keyword) {
            var keywords = keyword.split(' ');
            keywords.forEach(function(kw) {
                var regex = new RegExp('('+kw+')', 'gi');
                text = text.replace(regex, '<span style="background-color: yellow">$1</span>');
            });
            return text;
        }

        // Function to get products
        function getProducts() {
            var inp = document.getElementById('inputan').value.trim();
            var encodedInp = encodeURIComponent(inp);
            $.ajax({
                type: "GET",
                url: "http://localhost:8080/query/" + encodedInp,
                success: function (response) {
                    var found = false;
                    var processedPlants = {};
                    $("#product-list").empty();
                    response.forEach(function (data) {
                        var englishName = data.hasEnglishName.toLowerCase();
                        var medicinalPlant = data.medicinalPlant.substring(data.medicinalPlant.lastIndexOf('#') + 1).replace(/_/g , ' ').toLowerCase();
                        var localName = data.hasLocalName.substring(data.hasLocalName.lastIndexOf('#') + 1).replace(/_/g , ' ').toLowerCase();
                        
                        var treatDisease = '';
                        if (Array.isArray(data.treatDisease)) {
                            treatDisease = data.treatDisease.map(function(disease) {
                                return disease.substring(disease.lastIndexOf('#') + 1).replace(/_/g , ' ').toLowerCase();
                            }).join(', ');
                        } else {
                            treatDisease = data.treatDisease.substring(data.treatDisease.lastIndexOf('#') + 1).replace(/_/g , ' ').toLowerCase();
                        }

                        var searchTerm = inp.toLowerCase();
                        var fullMatch = searchTerm.split(' ').every(function(term) {
                            return englishName.includes(term) || medicinalPlant.includes(term) || localName.includes(term) || treatDisease.includes(term);
                        });

                        if (fullMatch && !processedPlants[data.id]) {
                            found = true;
                            var highlightedEnglishName = highlightKeyword(data.hasEnglishName, inp);
                            var highlightedMedicinalPlant = highlightKeyword(data.medicinalPlant.substring(data.medicinalPlant.lastIndexOf('#') + 1).replace(/_/g , ' '), inp);
                            var highlightedLocalName = highlightKeyword(data.hasLocalName.substring(data.hasLocalName.lastIndexOf('#') + 1).replace(/_/g , ' '), inp);
                            var highlightedTreatDisease = highlightKeyword(treatDisease, inp);

                            $("#product-list").append(
                                "<div class='col-md-4'>" +
                                "<a href='/medicinal/id/" + data.id + "' class='card'>" +
                                "<div class='card-header'>" + highlightedEnglishName + "</div>" +
                                "<div class='card-body'>" +
                                "<p><strong>Indonesian Name:</strong> " + highlightedMedicinalPlant + "</p>" +
                                "<p><strong>Local Name:</strong> " + highlightedLocalName + "</p>" +
                                "<p><strong>Treat Disease:</strong> " + highlightedTreatDisease + "</p>" +
                                "</div>" +
                                "</a>" +
                                "</div>"
                            );

                            processedPlants[data.id] = true;
                        }
                    });
                    if (!found) {
                        showError("Plants not available");
                    }
                },
            });
        }

        // Function to show error message
        function showError(message) {
            var errorOverlay = document.getElementById('error-overlay');
            var errorMessage = document.getElementById('error-message');
            errorMessage.innerText = message;
            errorOverlay.classList.add('visible');
            setTimeout(function() {
                errorOverlay.classList.remove('visible');
            }, 3000);
        }

        // Function to handle key press event
        function searchKeyPress(e) {
            var key = e.keyCode || e.which;
            if (key === 13) {
                getProducts();
                return false;
            }
            return true;
        }
    </script>

    <!-- Bootstrap JS -->
    <script th:src="@{css/bootstrap.js}"></script>

    <!-- Copyright section -->
    <footer class="text-center mt-4">
        <p>Copyright © 2024 TASI-2324-104. All Rights Reserved.</p>
    </footer>
</body>
</html>
