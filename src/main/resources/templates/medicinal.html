<!DOCTYPE html>
<html lang="en-US">
<head>
    <!-- Meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Discover various medicinal plants from Toba that are beneficial for health and natural healing.">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.6">
    <title>Toba Medicinal Plant</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">

    <!-- Custom styles -->
    <style>
        /* Global styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #FFFFFF;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        main {
            flex: 1;
            padding: 20px;
        }

        /* Navigation bar */
        .navbar {
            background-color: #333;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .navbar-brand {
            font-size: 24px;
            font-weight: bold;
        }

        /* Welcome section */
        .welcome-section {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 50px 20px;
            border-radius: 10px;
            margin-top: 50px;
            color: #000000;
            background-color: #FFFFFF;
        }

        .welcome-section img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            margin-right: 20px;
        }

        .welcome-text {
            max-width: 600px;
        }

        .welcome-text h1 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #000; /* Ubah warna teks menjadi hitam */
        }

        .welcome-text p {
            font-size: 18px;
            color: #000; /* Ubah warna teks menjadi hitam */
        }

        /* Search section */
        .search-section {
            margin-top: 30px;
            text-align: center;
            margin-bottom: 30px;
        }

        .input-group {
            width: 80%;
            margin: 0 auto;
        }

        .input-group-append {
            width: 20%;
        }

        /* Product list */
        #product-list {
            margin-top: 30px;
        }

        .card {
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #fff;
            transition: transform 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .card:hover {
            transform: scale(1.05);
        }

        .card-header {
            font-weight: bold;
            font-size: 18px;
        }

        .card-body {
            margin-top: 10px;
        }

        /* Wikipedia list */
        #wikipedia-list {
            margin-top: 30px;
        }

        .list-unstyled {
            padding: 0;
            list-style: none;
        }

        .media {
            margin-bottom: 20px;
        }

        .media img {
            width: 100px;
            height: auto;
            border-radius: 10px;
            margin-right: 20px;
        }

        .media-body {
            font-size: 18px;
        }

        /* Overlay */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
        }

        .overlay.visible {
            visibility: visible;
        }

        .overlay-content {
            background-color: #fff;
            padding: 20px;
            border-radius: 5px;
            text-align: center;
        }

        /* Animations */
        @keyframes slideDown {
            0% {
                transform: translateY(-100%);
            }
            100%{
                transform: translateY(0);
            }
        }

        #product-list, #wikipedia-list {
            animation: slideDown 0.5s ease-out;
        }

        /* Overlay loading */
        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            visibility: hidden;
        }

        #loading-overlay.visible {
            visibility: visible;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        /* Footer styles */
        footer {
            padding: 1rem;
            background-color: #f8f9fa; /* Light background */
            text-align: center;
            margin-top: auto; /* Push to bottom */
            width: 100%;
            position: relative;
            bottom: 0;
        }

    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
        <a class="navbar-brand" href="/medicinal">
            <img src="/res/player/Tanaman.png" alt="Toba Medicinal Plant" width="80" height="30" class="d-inline-block align-top">
            Toba Medicinal Plant
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault"
                aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarsExampleDefault">
        </div>
    </nav>

    <main role="main" class="container">
        <div class="welcome-section">
            <img src="/res/player/logo.png" alt="Toba Medicinal Plant"> <!-- Ganti dengan path gambar Anda -->
            <div class="welcome-text">
                <h1>Welcome to Toba Medicinal Plant</h1>
                <p>Discover various medicinal plants from Toba that are beneficial for health and natural healing.</p>
            </div>
        </div>
        <div class="row search-section">
            <div class="col-sm-8 offset-sm-2">
                <div class="input-group mb-3">
                    <input type="text" class="form-control" placeholder="Enter the name of the medicinal plant" id="inputan" onkeypress="return searchKeyPress(event);">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" onclick="getProducts()">Search</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- List tanaman -->
        <div id="product-list" class="row mt-3">
            <!-- Cards akan ditambahkan di sini -->
        </div>
        <!-- List Wikipedia -->
        <div id="wikipedia-list" class="row mt-3">
            <ul class="list-unstyled w-100">
                <!-- Wikipedia results will be appended here -->
            </ul>
        </div>
    </main>

    <!-- Loading-->
    <div id="loading-overlay" class="overlay">
        <div class="overlay-content">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
        </div>
    </div>
    
    <!-- Overlay for error messages -->
    <div id="error-overlay" class="overlay">
        <div class="overlay-content" id="error-message">
            <!-- Error message will be inserted here -->
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>

    <script type="text/javascript">
        // Function to highlight keyword in text
        function highlightKeyword(text, keyword) {
            var keywords = keyword.split(' ');
            keywords.forEach(function(kw) {
                var regex = new RegExp('(' + escapeRegExp(kw) + ')', 'gi');
                text = text.replace(regex, '<span style="background-color: yellow">$1</span>');
            });
            return text;
        }

        // Function to escape regular expression special characters
        function escapeRegExp(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'); // $& means the whole matched string
        }

        function getProducts() {
            var inp = document.getElementById('inputan').value.trim();
            var encodedInp = encodeURIComponent(inp);
        
            // Tampilkan overlay loading sebelum permintaan AJAX dimulai
            $('#loading-overlay').addClass('visible');
        
            $.ajax({
                type: "GET",
                url: "http://localhost:8080/query/" + encodedInp,
                success: function (response) {
                    // Sembunyikan overlay loading setelah mendapatkan respons
                    $('#loading-overlay').removeClass('visible');
        
                    var found = false;
                    var processedPlants = {};
        
                    response.forEach(function (data) {
                        found = true;
        
                        // Memproses setiap nilai atribut untuk disimpan di dalam objek processedPlants
                        var plantKey = data.hasEnglishName;
                        if (!processedPlants.hasOwnProperty(plantKey)) {
                            processedPlants[plantKey] = {
                                medicinalPlant: new Set(),
                                hasLocalName: new Set(),
                                hasClass: new Set(),
                                managedBy: new Set(),
                                utilizingParts: new Set(),
                                containsActiveCompounds: new Set(),
                                usedByMeansOf: new Set(),
                                hasSideEffect: new Set(),
                                hasDivisions: new Set(),
                                hasFamily: new Set(),
                                hasGenus: new Set(),
                                hasKingdom: new Set(),
                                hasOrder: new Set(),
                                hasSpecies: new Set(),
                                treatDisease: new Set(),
                                hasImageURL: data.hasImageURL,
                                id: data.id
                            };
                        }
        
                        // Memasukkan nilai ke dalam Set yang sesuai di dalam objek processedPlants
                        function addToSetIfValid(set, value) {
                            if (value && value.includes('#')) {
                                set.add(value.substring(value.lastIndexOf('#') + 1).replace(/_/g, ' ').toLowerCase());
                            }
                        }
        
                        addToSetIfValid(processedPlants[plantKey].medicinalPlant, data.medicinalPlant);
                        addToSetIfValid(processedPlants[plantKey].hasLocalName, data.hasLocalName);
                        addToSetIfValid(processedPlants[plantKey].hasClass, data.hasClass);
                        addToSetIfValid(processedPlants[plantKey].managedBy, data.managedBy);
                        addToSetIfValid(processedPlants[plantKey].utilizingParts, data.utilizingParts);
                        addToSetIfValid(processedPlants[plantKey].containsActiveCompounds, data.containsActiveCompounds);
                        addToSetIfValid(processedPlants[plantKey].usedByMeansOf, data.usedByMeansOf);
                        addToSetIfValid(processedPlants[plantKey].hasSideEffect, data.hasSideEffect);
                        addToSetIfValid(processedPlants[plantKey].hasDivisions, data.hasDivisions);
                        addToSetIfValid(processedPlants[plantKey].hasFamily, data.hasFamily);
                        addToSetIfValid(processedPlants[plantKey].hasGenus, data.hasGenus);
                        addToSetIfValid(processedPlants[plantKey].hasKingdom, data.hasKingdom);
                        addToSetIfValid(processedPlants[plantKey].hasOrder, data.hasOrder);
                        addToSetIfValid(processedPlants[plantKey].hasSpecies, data.hasSpecies);
                        addToSetIfValid(processedPlants[plantKey].treatDisease, data.treatDisease);
                    });
        
                    // Buat konten kartu dari nilai-nilai yang sudah diproses untuk setiap tanaman yang cocok
                    var cardContent = '';
                    Object.keys(processedPlants).forEach(function (plantKey) {
                        var plant = processedPlants[plantKey];
        
                        cardContent += '<div class="col-md-4">';
                        cardContent += '<a href="/medicinal/id/' + plant.id + '" class="card">';
                        cardContent += '<div class="position-relative">';
                        if (plant.hasImageURL) {
                            cardContent += '<img src="' + plant.hasImageURL + '" class="card-img-top" alt="' + plantKey + '">';
                        }
                        cardContent += '<div class="card-title-overlap">';
                        cardContent += '<h5 class="card-title" style="color: #00000; background-color: #e2e2e2; font-weight: bold; padding: 15px; border-radius: 5px;">' + highlightKeyword(plantKey, inp) + '</h5>';
                        cardContent += '</div>'; // End of card-title-overlap
                        cardContent += '</div>'; // End of position-relative
                        cardContent += '<div class="card-body">';
                        cardContent += '<ul class="list-unstyled">';
                        cardContent += '<li><strong>English Name:</strong> ' + highlightKeyword(plantKey, inp) + '</li>';
                        cardContent += '<li><strong>Indonesian Name:</strong> ' + highlightKeyword(Array.from(plant.medicinalPlant).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Local Name:</strong> ' + highlightKeyword(Array.from(plant.hasLocalName).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Class:</strong> ' + highlightKeyword(Array.from(plant.hasClass).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Processing Method:</strong> ' + highlightKeyword(Array.from(plant.managedBy).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Part:</strong> ' + highlightKeyword(Array.from(plant.utilizingParts).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Active Compounds:</strong> ' + highlightKeyword(Array.from(plant.containsActiveCompounds).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Used By Means Of:</strong> ' + highlightKeyword(Array.from(plant.usedByMeansOf).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Side Effect:</strong> ' + highlightKeyword(Array.from(plant.hasSideEffect).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Division:</strong> ' + highlightKeyword(Array.from(plant.hasDivisions).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Family:</strong> ' + highlightKeyword(Array.from(plant.hasFamily).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Genus:</strong> ' + highlightKeyword(Array.from(plant.hasGenus).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Kingdom:</strong> ' + highlightKeyword(Array.from(plant.hasKingdom).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Order:</strong> ' + highlightKeyword(Array.from(plant.hasOrder).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Species:</strong> ' + highlightKeyword(Array.from(plant.hasSpecies).join(', '), inp) + '</li>';
                        cardContent += '<li><strong>Treat Disease:</strong> ' + highlightKeyword(Array.from(plant.treatDisease).join(', '), inp) + '</li>';
                        cardContent += '</ul>';
                        cardContent += '</div></div>';
                        cardContent += '</a></div>';
                    });
        
                    // Menambahkan konten kartu ke dalam elemen product-list
                    $("#product-list").empty().append(cardContent);
        
                    // Jika tidak ada tanaman yang ditemukan, tampilkan pesan error
                    if (!found) {
                        showError("No plants found with the given search criteria.");
                    } else {
                        getWikipediaResults(inp);
                    }
                },
                error: function () {
                    // Sembunyikan overlay loading jika terjadi kesalahan
                    $('#loading-overlay').removeClass('visible');
                    showError("Failed to fetch plant data. Please try again later.");
                }
            });
        }
        

// Fungsi untuk menyorot kata kunci dalam teks
function highlightKeyword(text, keyword) {
    var pattern = new RegExp(keyword, "gi");
    return text.replace(pattern, function(match) {
        return '<span style="background-color: yellow;">' + match + '</span>';
    });
}




        // Function to get Wikipedia results with images and related topics
        function getWikipediaResults(query) {
            var encodedQuery = encodeURIComponent(query);
            var plantKeywords = ["plant", "tanaman", "tumbuhan", "medicinal", "flora", "botany", "species", "disease", "taxonomy"]; // Keywords to filter out non-plant related Wikipedia results
            $.ajax({
                type: "GET",
                url: "https://en.wikipedia.org/w/api.php?action=query&list=search&srsearch=" + encodedQuery + "&format=json&origin=*",
                success: function (response) {
                    $("#wikipedia-list ul").empty();
                    response.query.search.forEach(function (result) {
                        var title = result.title.toLowerCase();
                        var snippet = result.snippet.toLowerCase();
                        var pageUrl = "https://en.wikipedia.org/wiki/" + encodeURIComponent(result.title);

                        var isPlantRelated = plantKeywords.some(function(keyword) {
                            return title.includes(keyword) || snippet.includes(keyword);
                        });

                        if (isPlantRelated) {
                            // Request to get image
                            $.ajax({
                                type: "GET",
                                url: "https://en.wikipedia.org/w/api.php?action=query&titles=" + encodeURIComponent(result.title) + "&prop=pageimages&format=json&pithumbsize=100&origin=*",
                                success: function (imageResponse) {
                                    var pages = imageResponse.query.pages;
                                    var imageUrl = '';
                                    for (var pageId in pages) {
                                        if (pages[pageId].thumbnail) {
                                            imageUrl = pages[pageId].thumbnail.source;
                                        }
                                    }

                                    // Highlight keyword in snippet
                                    var highlightedSnippet = highlightKeyword(result.snippet, query);

                                    // Append result with image
                                    $("#wikipedia-list ul").append(
                                        "<li class='media my-4'>" +
                                        (imageUrl ? "<img class='mr-3' src='" + imageUrl + "' alt='Image' width='100'>" : "") +
                                        "<div class='media-body'>" +
                                        "<h5 class='mt-0 mb-1'><a href='" + pageUrl + "'>" + highlightKeyword(result.title, query) + "</a></h5>" +
                                        highlightedSnippet + "..." +
                                        "</div>" +
                                        "</li>"
                                    );
                                },
                                error: function () {
                                    showError("Failed to fetch image for " + result.title);
                                }
                            });
                        }
                    });
                },
                error: function () {
                    showError("Failed to fetch Wikipedia results");
                }
            });
        }

        // Function to show error message
        function showError(message) {
            var errorOverlay = document.getElementById('error-overlay');
            var errorMessage = document.getElementById('error-message');
            errorMessage.innerText = message;
            errorOverlay.classList.add('visible');
            setTimeout(function() {
                errorOverlay.classList.remove('visible');
            }, 3000);
        }

        // Function to handle key press event
        function searchKeyPress(e) {
            var key = e.keyCode || e.which;
            if (key === 13) {
                getProducts();
                return false;
            }
            return true;
        }
    </script>

        <!-- Bootstrap JS -->
        <script th:src="@{css/bootstrap.js}"></script>

        <!-- Copyright section -->
        <footer>
            <p>Copyright © 2024 TASI-2324-104. All Rights Reserved.</p>
        </footer>
</body>
</html>